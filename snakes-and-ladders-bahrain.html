<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³Ù„Ù… ÙˆØ§Ù„Ø«Ø¨Ø§Øª - Ù„Ø¹Ø¨ Ø¬Ù…Ø§Ø¹ÙŠ 2-4 Ù„Ø§Ø¹Ø¨ÙŠÙ†</title>
  <style>
    :root{--cell:48px}
    body{font-family: Tahoma, Arial, sans-serif;background:#f6f9fc;color:#111;margin:0;padding:20px;}
    h1{margin:0 0 10px;font-size:20px}
    .top{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .controls{background:white;padding:12px;border-radius:10px;box-shadow:0 4px 14px rgba(2,6,23,.06)}
    label{display:inline-block;margin:0 8px 0 0}
    button{padding:8px 12px;border-radius:8px;border:0;background:#1d4ed8;color:white;cursor:pointer}
    button:disabled{opacity:.5;cursor:default}
    #board{margin-top:16px;display:grid;grid-template-columns:repeat(10,var(--cell));gap:4px;direction:ltr}
    .cell{width:var(--cell);height:var(--cell);background:white;border-radius:6px;display:flex;flex-direction:column;justify-content:space-between;padding:4px;font-size:11px;box-shadow:0 1px 3px rgba(2,6,23,.06)}
    .cell .num{font-weight:700;font-size:10px;opacity:.7}
    .players-indicators{display:flex;gap:6px}
    .player-token{width:18px;height:18px;border-radius:50%;display:inline-block;border:2px solid white}
    .p1{background:#ef4444}
    .p2{background:#10b981}
    .p3{background:#f59e0b}
    .p4{background:#6366f1}
    #log{margin-top:10px;background:#fff;padding:8px;border-radius:8px;font-size:13px;max-height:120px;overflow:auto}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);}
    .card{background:white;padding:18px;border-radius:12px;max-width:540px;width:92%;box-shadow:0 8px 30px rgba(2,6,23,.25)}
    .options{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .option{padding:10px;border-radius:8px;border:1px solid #e5e7eb;cursor:pointer}
    .option:hover{background:#f3f4f6}
    .small{font-size:12px;color:#555}
    footer{margin-top:14px;color:#555}
    .legend{display:flex;gap:10px;align-items:center}
    .board-row{display:contents}
  </style>
</head>
<body>
  <h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³Ù„Ù… ÙˆØ§Ù„Ø«Ø¨Ø§Øª (2-4 Ù„Ø§Ø¹Ø¨ÙŠÙ†) â€” Ø£Ø³Ø¦Ù„Ø© Ø¹Ù† Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† Ø¨Ø¹Ø¯ ÙƒÙ„ Ø±Ù…ÙŠØ©</h1>
  <div class="top">
    <div class="controls">
      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†:
        <select id="numPlayers">
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4" selected>4</option>
        </select>
      </label>
      <label>Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
      <input id="names" placeholder="Ø§ÙØµÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¨ÙØ§ØµÙ„Ø© (Ù…Ø«Ø§Ù„: Ø¹Ù„ÙŠ,Ø³Ø§Ø±Ø©)" />
      <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
    </div>
    <div style="margin-left:auto; text-align:left">
      <div class="legend small">
        <span class="player-token p1" title="Ù„Ø§Ø¹Ø¨ 1"></span> Ù„Ø§Ø¹Ø¨ 1
        <span class="player-token p2" title="Ù„Ø§Ø¹Ø¨ 2"></span> Ù„Ø§Ø¹Ø¨ 2
        <span class="player-token p3" title="Ù„Ø§Ø¹Ø¨ 3"></span> Ù„Ø§Ø¹Ø¨ 3
        <span class="player-token p4" title="Ù„Ø§Ø¹Ø¨ 4"></span> Ù„Ø§Ø¹Ø¨ 4
      </div>
      <div class="small">Ù‚ÙˆØ§Ø¹Ø¯ Ø³Ø±ÙŠØ¹Ø©: Ø¨Ø¹Ø¯ ÙƒÙ„ Ø±Ù…ÙŠØ© Ù†Ø±Ø¯ Ø³ÙŠØ¸Ù‡Ø± Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†. Ø¥Ù† Ø£Ø¬Ø¨Øª ØµØ­ ØªØªØ­Ø±Ùƒ Ø¨Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„. Ø¥Ù† Ø£Ø®Ø·Ø£Øª ØªØªØ­Ø±Ùƒ Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·.</div>
    </div>
  </div>

  <div id="board"></div>

  <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
    <div>
      <button id="rollBtn" disabled>Ø±Ù…Ù‘ÙŠ Ø§Ù„Ù†Ø±Ø¯ ğŸ²</button>
      <div class="small" id="currentTurn"></div>
    </div>
    <div id="diceFace" class="small">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø±Ù…ÙŠØ©: -</div>
  </div>

  <div id="log"></div>

  <!-- Modal for question -->
  <div id="questionModal" class="modal" style="display:none">
    <div class="card">
      <div id="questionText" style="font-weight:700"></div>
      <div id="questionInfo" class="small" style="margin-top:6px;color:#333">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</div>
      <div class="options" id="optionsArea"></div>
      <div style="margin-top:12px;text-align:left">
        <button id="skipBtn">ØªØ®Ø·ÙŠ (ØªØ­Ø±Ùƒ 1 Ø®Ø·ÙˆØ©)</button>
      </div>
    </div>
  </div>

  <script>
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„ÙˆØ­ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
    const boardEl = document.getElementById('board');
    const cells = Array(101); // cells[1] Ø§Ù„Ù‰ cells[100]
    for(let r=10;r>=1;r--){
      const rowNum = 11 - r; // Ø§Ù„ØµÙ Ù…Ù† 1..10
      const reverse = rowNum % 2 === 0;
      for(let c=1;c<=10;c++){
        const col = reverse ? (11-c) : c; // Ø§Ø³ØªØ®Ø¯Ø§Ù… 11-c Ù„ÙŠØ¹Ø·ÙŠ 10..1 Ø§Ø°Ø§ Ù…Ø¹ÙƒÙˆØ³
        const n = (r-1)*10 + col;
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.innerHTML = `<div class="num">${n}</div><div class="tokens" style="display:flex;gap:2px;justify-content:flex-end"></div>`;
        boardEl.appendChild(cell);
        if(n >= 1 && n <= 100) {
          cells[n] = cell;
        }
      }
    }

    // Ø³Ù„Ø§Ù„Ù… ÙˆØ­ÙŠØ§Øª (Ø§Ù„Ø³Ù„Ù… ÙˆØ§Ù„Ø«Ø¹Ø¨Ø§Ù†)
    const jumps = {
      4:14,   9:31, 17:7, 20:38, 28:84, 40:59, 51:67, 54:34, 62:19, 63:81, 64:60, 71:91, 87:24, 93:73, 95:75, 99:78
    };

    const defaultQuestions = [
      {q: 'Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ØŸ', choices: ['Ø§Ù„Ù…Ù†Ø§Ù…Ø©','Ø§Ù„Ø±ÙØ§Ø¹','Ø§Ù„Ù…Ø­Ø±Ù‚','Ø£Ù… Ø§Ù„Ø­ØµÙ…'], a:0},
      {q: 'Ù…Ø§ Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ØŸ', choices: ['Ø¯ÙŠÙ†Ø§Ø± Ø¨Ø­Ø±ÙŠÙ†ÙŠ','Ø¯Ø±Ù‡Ù…','Ø±ÙŠØ§Ù„','Ø¯ÙˆÙ„Ø§Ø±'], a:0},
      {q: 'Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ø²Ø± Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ØŸ', choices: ['Ø¬Ø²Ø± Ø§Ù„Ù…Ø­Ø±Ù‚','Ø¬Ø²Ø± ÙÙˆÙƒÙ„Ø§Ù†Ø¯','Ø¬Ø²ÙŠØ±Ø© ÙƒØ±ÙŠØª','Ø¬Ø²ÙŠØ±Ø© ÙƒÙˆØ±ÙŠØ§'], a:0},
      {q: 'Ù…ØªÙ‰ Ù†Ø§Ù„Øª Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† Ø§Ø³ØªÙ‚Ù„Ø§Ù„Ù‡Ø§ Ø§Ù„Ø±Ø³Ù…ÙŠØŸ', choices: ['1971','1960','1981','1990'], a:0},
      {q: 'Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ø­Ø§ÙƒÙ… (Ø§Ù„Ù…Ù„Ùƒ) Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ØŸ', choices: ['Ø­Ù…Ø¯ Ø¨Ù† Ø¹ÙŠØ³Ù‰ Ø¢Ù„ Ø®Ù„ÙŠÙØ©','Ù†Ø§ØµØ± Ø¨Ù† Ø­Ù…Ø¯','Ø­Ù…Ø¯ Ø¨Ù† Ø³Ù„Ù…Ø§Ù†','Ù…Ù„Ùƒ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'], a:0},
      {q: 'Ù…Ø§ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© Ø§Ù„Ø£Ø¨Ø±Ø² ØªÙ‚Ù„ÙŠØ¯ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ØŸ', choices: ['Ø³Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ù‡Ø¬Ù†','ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…','ÙƒØ±Ø© Ø§Ù„Ø³Ù„Ø©','Ø§Ù„Ø³Ø¨Ø§Ø­Ø©'], a:0},
      {q: 'Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ØªÙŠ ØªØ´ØªÙ‡Ø± Ø¨Ø³ÙˆÙ‚ Ø§Ù„Ø°Ù‡Ø¨ ÙÙŠ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ØŸ', choices: ['Ø§Ù„Ù…Ù†Ø§Ù…Ø©','Ø§Ù„Ù…Ø­Ø±Ù‚','Ø§Ù„Ø±ÙØ§Ø¹','Ø¬Ø²Ø± Ø­ÙˆØ§Ø±'], a:0},
      {q: 'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠØ´ØªÙ‡Ø± Ø¨Ù‡ Ø®ÙˆØ± Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠØ§Ù‹ØŸ', choices: ['ØµÙŠØ¯ Ø§Ù„Ù„Ø¤Ù„Ø¤','Ø§Ù„Ø«Ù„ÙˆØ¬','Ø§Ù„Ø¬Ø¨Ø§Ù„','Ø§Ù„ØºØ§Ø¨Ø§Øª Ø§Ù„ÙƒØ«ÙŠÙØ©'], a:0}
    ];

    // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø©
    const startBtn = document.getElementById('startBtn');
    const numPlayersSel = document.getElementById('numPlayers');
    const namesInput = document.getElementById('names');
    const rollBtn = document.getElementById('rollBtn');
    const diceFace = document.getElementById('diceFace');
    const log = document.getElementById('log');
    const currentTurnEl = document.getElementById('currentTurn');
    const qModal = document.getElementById('questionModal');
    const qText = document.getElementById('questionText');
    const optionsArea = document.getElementById('optionsArea');
    const skipBtn = document.getElementById('skipBtn');

    let players = [];
    let turnIndex = 0;
    let questions = defaultQuestions.slice();

    function logMsg(txt){
      const d = document.createElement('div'); d.textContent = txt; log.prepend(d);
    }

    function startGame(){
      // reset
      clearBoardTokens();
      players = [];
      const n = parseInt(numPlayersSel.value,10);
      const names = namesInput.value.split(',').map(s=>s.trim()).filter(x=>x);
      for(let i=0;i<n;i++){
        players.push({name: names[i]||('Ø§Ù„Ù„Ø§Ø¹Ø¨ '+(i+1)), pos:0, cls: 'p'+(i+1)});
      }
      turnIndex = 0;
      renderAllTokens();
      rollBtn.disabled = false;
      log.innerHTML = '';
      logMsg('Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø© â€” Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† '+players.length);
      updateTurnText();
      diceFace.textContent = "Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø±Ù…ÙŠØ©: -";
      questions = defaultQuestions.slice();
    }

    function updateTurnText(){
      const p = players[turnIndex];
      currentTurnEl.textContent = `Ø¯ÙˆØ±: ${p.name}`;
    }

    function clearBoardTokens(){
      for(let i=1;i<=100;i++){
        if(cells[i]) {
          const ta = cells[i].querySelector('.tokens'); ta.innerHTML='';
        }
      }
    }

    function renderAllTokens(){
      clearBoardTokens();
      players.forEach((pl,idx)=>{
        const pos = pl.pos || 0;
        if(pos>0 && pos<=100 && cells[pos]){
          const ta = cells[pos].querySelector('.tokens');
          const el = document.createElement('span'); el.className = 'player-token '+pl.cls; el.title = pl.name; ta.appendChild(el);
        }
      });
    }

    function rollDice(){
      rollBtn.disabled = true;
      const d1 = Math.floor(Math.random()*6)+1;
      const d2 = Math.floor(Math.random()*6)+1;
      const sum = d1 + d2;
      diceFace.textContent = `Ø£Ù„Ù‚ÙŠØª: ${d1} + ${d2} = ${sum}`;
      // show question modal before moving
      showQuestionForCurrent(sum);
    }

    function showQuestionForCurrent(sum){
      // pick a random question
      if(questions.length===0) questions = defaultQuestions.slice();
      const idx = Math.floor(Math.random()*questions.length);
      const q = questions.splice(idx,1)[0];
      qText.textContent = q.q;
      optionsArea.innerHTML = '';
      q.choices.forEach((choice,i)=>{
        const btn = document.createElement('div'); btn.className='option'; btn.textContent = choice; btn.onclick = ()=>{
          const correct = i===q.a;
          closeQuestionModal();
          handleAnswerResult(correct,sum);
        };
        optionsArea.appendChild(btn);
      });
      skipBtn.onclick = ()=>{ closeQuestionModal(); handleAnswerResult(false,sum); };
      qModal.style.display='flex';
    }

    function closeQuestionModal(){ qModal.style.display='none'; }

    function handleAnswerResult(correct,sum){
      const p = players[turnIndex];
      if(correct){
        logMsg(`${p.name} Ø£Ø¬Ø§Ø¨ ØµØ­ÙŠØ­Ø§Ù‹! ÙŠØªØ­Ø±Ùƒ ${sum} Ø®Ø·ÙˆØ©.`);
        movePlayer(turnIndex, sum);
      } else {
        logMsg(`${p.name} Ø£Ø¬Ø§Ø¨ Ø®Ø·Ø£. ÙŠØªØ­Ø±Ùƒ 1 Ø®Ø·ÙˆØ© ÙÙ‚Ø·.`);
        movePlayer(turnIndex, 1);
      }
    }

    function movePlayer(i, steps){
      const pl = players[i];
      let newPos = pl.pos + steps;
      if(newPos>100){
        logMsg(`${pl.name} ØªØ­Ø±Ùƒ Ù„ÙƒÙ† ØªØ¬Ø§ÙˆØ² 100 â€” ÙŠØ¨Ù‚Ù‰ ÙÙŠ Ù…ÙƒØ§Ù†Ù‡ Ø­ØªÙ‰ ÙŠØ±Ù…Ù‰ Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨`);
        // do not move
      } else {
        pl.pos = newPos;
        logMsg(`${pl.name} Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ù†Ø© ${pl.pos}`);
        // check jumps
        if(jumps[pl.pos]){
          const dest = jumps[pl.pos];
          if(dest > pl.pos){
            logMsg(`Ø³Ù„Ù…! ${pl.name} ÙŠØµØ¹Ø¯ Ø¥Ù„Ù‰ ${dest}`);
          } else {
            logMsg(`Ø«Ø¹Ø¨Ø§Ù†! ${pl.name} ÙŠÙ†Ø²Ù„ Ø¥Ù„Ù‰ ${dest}`);
          }
          pl.pos = dest;
          logMsg(`${pl.name} Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø© ${pl.pos}`);
        }
      }
      renderAllTokens();
      // check win
      if(pl.pos === 100){
        logMsg(`ğŸ‰ ${pl.name} ÙØ§Ø² Ø¨Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©!`);
        rollBtn.disabled = true;
        currentTurnEl.textContent = `${pl.name} ÙØ§Ø²!`;
        return;
      }
      // next turn
      turnIndex = (turnIndex + 1) % players.length;
      updateTurnText();
      rollBtn.disabled = false;
    }

    startBtn.addEventListener('click', ()=>{
      startGame();
    });
    rollBtn.addEventListener('click', ()=>{ rollDice(); });

    // No need for DOMContentLoaded logic since everything loads in the right order

  </script>

</body>
</html>